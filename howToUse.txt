一、插件概述该插件是基于客户端 - 服务器（C/S）架构的网络联机框架，通过四层结构（W 层、E 层、N 层、S 层）实现从底层通信到上层业务逻辑的封装。支持多协议扩展（TCP、UDP），兼容兼容局域网房间联机与远程服务器联机场景，可通过统一接口实现两种模式的无缝切换。
二、核心架构与层级说明
W 层（协议封装层）
作用：封装网络通信协议，支持多协议扩展。
核心类：
ProtocolBase：协议基类，需实现数据发送（Send）和接收（Receive）逻辑，客户端通过该类与服务器通信。
ListenerBase：侦听器基类，需实现协议的开启（StartListening）和关闭（StopListening）逻辑，服务器通过该类监听连接请求，并为每个客户端分配 ProtocolBase 实例。
已实现协议：TCP、UDP，用户可通过继承上述基类扩展其他协议（如 WebSocket）。
E 层（局域网连接层）
作用：处理局域网内的连接管理、事件分发，提供基础联机操作接口。
核心组件 ENCCorrespondent：挂载在场景中，通过 ENCInstance.ENCCorrespondent 全局访问，主要功能如下：
配置项：可在 Inspector 或脚本中设置 IP（默认 127.0.0.1）、Port（默认 65432）；设置接收模式（Multithreading 多线程 / Asynchronous 异步）；选择协议类型（TCP/UDP）；设置关键信息相关时长（KeyExistTime、KeySendInterval、RKeyExistTime）；设置日志开关（MessyLog、DevelopmentDebug、ShowGeneralEvent）；设置心跳检测参数（DisconnectThreshold 超时阈值默认 3 秒、HeartbeatMsgInterval 发送间隔默认 0.2 秒）。
核心方法：
StartServer ()：启动服务器，启动前需确保网络模式为 None 且 IP 和端口有效。
StartClient ()：启动客户端连接到指定服务器，启动前需确保网络模式为 None 且 IP 和端口有效。
StartHost ()：启动主机（兼具服务器和客户端功能），启动前需确保网络模式为 None 且 IP 和端口有效。
ShutDown ()：关闭当前连接，根据当前网络模式（Server/Client/Host）分别关闭对应组件，并重置网络模式。
网络模式（NetworkMode）：包括 None（未启动）、Server（服务器）、Client（客户端）、Host（主机）。
全局实例 ENCInstance：
存储连接状态和配置参数，通过 ENCCorrespondent 的 ApplySettings 方法初始化。
暴露关键事件：
OnClientConnect：新客户端连接到服务器时触发（非自身）。
OnClientDisconnect：客户端断开连接时触发（非自身）。
OnServerConnect：自身连接到服务器并分配 ID 后触发。
OnServerDisconnect：自身与服务器断开时触发。
OnConnectFailed：客户端连接超时失败时触发。
N 层（网络物体管理层）
作用：管理网络物体的生成、同步和生命周期，支持跨客户端函数调用。
核心类与组件：
NOMBehaviour：网络行为基类，提供函数同步和生命周期管理。
对象 ID（ObjectId）：唯一标识网络物体（<0 为场景初始物体，>0 为动态生成物体）。
函数同步：通过 CallFuncRpc 系列方法实现跨客户端函数调用，支持目标指定（-1 = 所有客户端，-2 = 排除自身）、字符串参数和延迟调用。
生命周期：DestroyRpc ()（同步销毁）、DestroyLocal ()（本地销毁）。
NOMBehaviourCollection：网络行为集合，挂载在预制体上，聚合该物体的所有 NOMBehaviour 组件。
配置：在 Inspector 中手动将 NOMBehaviour 组件添加到 Behaviors 列表。
初始化与重生：重写 Init (string data) 和 Respawn (string data) 处理生成 / 重生时的参数。
NOMSpawner：网络物体生成器，负责同步生成网络物体。
预制体管理：在 Prefabs 列表中添加需同步的预制体，自动分配唯一 NOMCollectionId。
生成接口：CreateServerRpc 系列方法支持同步生成物体，可指定目标客户端和初始化参数。
重生检查：RespawnCheckServerRpc 确保所有客户端存在指定物体（缺失则自动重生）。
全局实例 NOMInstance：
管理网络物体 ID 分配、更新优先级和映射关系。
支持按优先级执行 ManagedUpdate 和 FixedManagedUpdate（通过 NOMPriorityAttribute 标记优先级）。
网络物体更新机制：
优先级控制：通过 NOMPriorityAttribute 标记更新优先级（值越高越先执行），不同优先级的更新会分批发送，防止单帧数据超过 1500 字节触发底层协议的分片机制。
忽略更新：通过 NOMIgnoreAttribute 标记的方法不会被自动调用，适用于无需同步的本地逻辑。
执行时机：
ManagedUpdate：每帧调用，用于高频非物理同步（如位置同步、状态更新）。
FixedManagedUpdate：固定帧率调用（与 Unity 的 FixedUpdate 同步），用于物理相关同步（如刚体受力、碰撞检测）。
网络物体销毁规则：必须使用 NOMBehaviour 提供的销毁方法，禁止直接调用 Destroy (gameObject)：
DestroyRpc ()：同步销毁，所有客户端都会销毁该物体，触发 NOMOnDestroy 清理 ID，适用于玩家退出、道具消耗等需要全服同步的销毁场景。
DestroyLocal ()：本地销毁，仅当前客户端销毁物体，不影响其他客户端，适用于临时特效、本地 UI 物体等无需同步的销毁场景。
S 层（远程服务器联机层）
作用：适配远程服务器联机，实现房间隔离，使局域网与远程逻辑通用。
核心组件与接口：
SRCDedicatedServer：远程专用服务器类，继承自 ENCServer，负责远程连接管理和房间隔离。
初始化：需指定 IP 地址和端口，通过 StartListening () 启动监听。
房间管理：内置 SRCRoomManager，确保广播仅在同一房间内生效。
更新逻辑：通过循环调用 Update () 处理服务器帧逻辑。
SRCCorrespondent：远程连接通讯器，继承自 NOMCorrespondent。
独立配置：ServerIP 和 ServerPort 单独设置，与 E 层的 IP/Port 分离。
核心方法：
StartSRCClient ()：启动远程客户端，连接到指定远程服务器。
JoinRoom (int id)：房间操作（id>0 加入房间，id=0 创建房间，id<0 退出房间）。
全局实例 SRCInstance：管理远程连接状态，暴露关键事件。
OnServerConnected：连接到远程服务器时触发。
OnServerDisconnect：与远程服务器断开时触发。
OnJoinFailed：加入房间失败时触发。
状态变量：PresentRoomId（当前房间 ID）、SRCOn（远程模式开关）、SRCHost（是否为房间主机）。
远程连接流程：
部署服务器：创建远程服务器实例，指定 IP、端口和协议类型，启动监听并循环更新。
客户端连接：通过 SRCCorrespondent 设置远程服务器 IP 和端口，启动远程客户端，连接成功后调用 JoinRoom 方法加入或创建房间。
与 E 层的核心区别：
连接目标：E 层直接连接局域网内的主机 IP；S 层先连接远程服务器，再加入房间。
IP/Port 配置：E 层共享 ENCCorrespondent 的 IP/Port；S 层独立使用 SRCCorrespondent 的 ServerIP/ServerPort。
事件触发时机：E 层连接成功后立即触发 ENC 事件；S 层连接服务器仅触发 SRC 事件，加入房间后才触发 ENC 事件。
隔离单位：E 层无房间概念，所有连接在同一空间；S 层以房间为隔离单位，不同房间互不干扰。
三、快速上手指南
局域网联机流程
场景配置：创建空物体 “NetworkManager”，添加 NOMCorrespondent 组件，配置 IP 和端口。
网络物体制作：创建预制体并添加 NOMBehaviourCollection 组件，添加自定义 NOMBehaviour 组件并拖拽到 Behaviors 列表，将预制体添加到 NOMSpawner 的 Prefabs 列表。
联机逻辑实现：通过 ENCCorrespondent 的 StartHost/StartClient 方法启动联机，监听 ENCInstance 的事件处理连接和客户端加入，调用 NOMSpawner 的 CreateServerRpc 生成网络物体。
远程服务器联机流程
部署远程服务器：参考相关示例代码部署服务器。
客户端连接：通过 SRCCorrespondent 连接服务器并加入房间，复用局域网中的网络物体同步逻辑，替换事件监听为 SRCInstance 的远程事件。
四、高级功能
协议扩展：继承 ProtocolBase 和 ListenerBase 实现自定义协议的发送、接收和监听逻辑，在服务器 / 客户端中替换默认协议。
带参数初始化物体：继承 NOMBehaviourCollection 并重写 Init 方法处理参数，生成时通过 CreateServerRpc 传入参数。
五、常见问题
连接失败：检查 IP 和端口是否正确，确保服务器已启动，关闭防火墙或添加端口例外。
物体不同步：确认预制体已添加到 NOMSpawner 的 Prefabs 列表，检查 NOMBehaviour 的 nomEnabled 是否为 true。
参数传递错误：避免使用非法字符（*、#、[、]、%、^ 及目标分隔符）。
远程房间隔离问题：确保使用 SRCInstance 的接口处理房间操作，而非直接调用 E 层方法。